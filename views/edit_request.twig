{% extends 'base.twig' %}
{% macro bytesToSize(bytes) %}
{% spaceless %}
    {% set kilobyte = 1024 %}
    {% set megabyte = kilobyte * 1024 %}
    {% set gigabyte = megabyte * 1024 %}
    {% set terabyte = gigabyte * 1024 %}
    {% if bytes < kilobyte %}
        {{ bytes ~ ' B' }}
    {% elseif bytes < megabyte %}
        {{ (bytes / kilobyte)|number_format(2, '.') ~ ' KB' }}
    {% elseif bytes < gigabyte %}
        {{ (bytes / megabyte)|number_format(2, '.') ~ ' MB' }}
    {% elseif bytes < terabyte %}
        {{ (bytes / gigabyte)|number_format(2, '.') ~ ' GB' }}
    {% else %}
        {{ (bytes / terabyte)|number_format(2, '.') ~ ' TB' }}
    {% endif %}
{% endspaceless %}
{% endmacro %}
{% import _self as filesize_calc %}
{% block title %}
<!-- bytesToSize macro by Chausser from Stack Exchange: http://stackoverflow.com/questions/15280310/readable-file-sizes-with-the-twig-templating-system -->
<title>{{caserow.0.case_id}}/{{ caserow.0.case_added_date|date("Y") }} {{ lang.edit_request }} - {{ settings.title_text }}</title>
{% endblock title %}
{% block content %}

<!-- http://stackoverflow.com/questions/1009808/enter-key-press-behaves-like-a-tab-in-javascript -->

<script>
$('body').on('keydown', 'input, select, textarea', function(e) {
var self = $(this)
  , form = self.parents('form:eq(0)')
  , focusable
  , next
  , prev
  ;

if (e.shiftKey) {
 if (e.keyCode == 13) {
     focusable =   form.find('input,a,select,button,textarea').filter(':visible');
     prev = focusable.eq(focusable.index(this)-1);

     if (prev.length) {
        prev.focus();
     } else {
        form.submit();
    }
  }
}
  else
if (e.keyCode == 13) {
    focusable = form.find('input,a,select,button,textarea').filter(':visible');
    next = focusable.eq(focusable.index(this)+1);
    if (next.length) {
        next.focus();
    } else {
        form.submit();
    }
    return false;
}
});

$(function() {
  var availableTags = [{{ confCrimes|raw }}];
  $("#case_crime").autocomplete({
    source: availableTags
  });
});
$(function() {
  $("#case_confiscation_date").datepicker({
    dayNamesMin: ["{{ lang.weekday_7_short }}", "{{ lang.weekday_1_short }}", "{{ lang.weekday_2_short }}", "{{ lang.weekday_3_short }}", "{{ lang.weekday_4_short }}", "{{ lang.weekday_5_short }}", "{{ lang.weekday_6_short }}"],
    dateFormat: "yy-mm-dd",
    monthNames: ["{{ lang.month_1 }}", "{{ lang.month_2 }}", "{{ lang.month_3 }}", "{{ lang.month_4 }}", "{{ lang.month_5 }}", "{{ lang.month_6 }}", "{{ lang.month_7 }}", "{{ lang.month_8 }}", "{{ lang.month_9 }}", "{{ lang.month_10 }}", "{{ lang.month_11 }}", "{{ lang.month_12 }}"],
    monthNamesShort: ["{{ lang.month_1|slice(0, 4) }}", "{{ lang.month_2|slice(0, 4) }}", "{{ lang.month_3|slice(0, 4) }}", "{{ lang.month_4|slice(0, 4) }}", "{{ lang.month_5|slice(0, 4) }}", "{{ lang.month_6|slice(0, 4) }}", "{{ lang.month_7|slice(0, 4) }}", "{{ lang.month_8|slice(0, 4) }}", "{{ lang.month_9|slice(0, 4) }}", "{{ lang.month_10|slice(0, 4) }}", "{{ lang.month_11|slice(0, 4) }}", "{{ lang.month_12|slice(0, 4) }}"],
    firstDay: ["1"],
    showButtonPanel: ["false"],
    closeText: ["{{ lang.close }}"],
    currentText: ["{{ lang.today }} "]
  });
});

</script>

{% for entry in caserow %}
<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
  <ol class="breadcrumb">
    <li><a href="index.php?year={{ caserow.0.case_added_date|date("Y") }}">{{ lang.front_page }} {{ caserow.0.case_added_date|date("Y") }}</a></li>
    <li>{{ caserow.0.case_id }}/{{ caserow.0.case_added_date|date("Y") }} {{ caserow.0.case_name }} {{ caserow.0.case_file_number }}</li>
  </ol>
  <div>
    <!-- Tab panes -->
    <div class="tab-content">
      <div role="tabpanel" class="tab-pane{% if not returntab %} active{% endif %}" id="tab-exam-request">
        {% if ((not entry.forensic_investigator) and (not entry.phone_investigator)) and (entry.case_status <="2" )%}
        <script type="text/javascript">
          $(document).ready(function() { $('#add_forensic_examiner_modal').modal('show'); });
        </script>
        <div class="modal fade" id="add_forensic_examiner_modal" role="dialog" aria-labelledby="myModalLabel">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">{{ lang.new_examination_request }} {{ entry.case_id }}/{{ entry.case_added_date|date("Y") }}</h4>
              </div>
              <div class="modal-body">
                <b>{{ lang.no_examiner_assigned }}</b>
                <p>{{ lang.pick_examiner }}</p>
                <form name="add_forensic_investigator" class="form" role="form" method="post" action="submit.php?type=case_update&uid={{ entry.parent_id }}">
                  <input type="hidden" name="token" value="{{session.user.token}}">
                  <input type="hidden" name="ct" value="{{ct}}">
                  <div class="form-group">
                    <select style="text-align:left;width:100%;" class="btn btn-default" name="forensic_investigator" id="forensic_investigator">
                      <option disabled>{{ lang.forensic_examiner_long }}</option>
                      {% for user in session.all_users %}
                        {% if 'F' in user.flags == true %}
                          <option value="{{ user.name }}" {% if user.name == session.user.name %}selected{% endif %}>{{ user.name }} ({{user.username}})</option>
                        {% endif %}
                      {% endfor %}
                      <option value="-">* {{ lang.mobile_examination_only }}</option>
                    </select>
                  </div>
                  {% if entry.case_contains_mob_dev == "1" %}
                  <b>{{ lang.request_contains_mobile_devices }}</b>
                  <p>{{ lang.pick_mobile_examiner }}</p>
                  <div class="form-group">
                    <input type="hidden" name="phone_investigator" value="">
                    <select style="text-align:left;width:100%;" class="btn btn-default" name="phone_investigator" id="phone_investigator">
                      <option selected disabled>{{ lang.mobile_examiner_long }}</option>

                      {% for user in session.all_users %}
                        {% if 'M' in user.flags == true %}
                          <option value="{{ user.name }}" {% if user.name == session.user.name %}selected{% endif %}>{{ user.name }} ({{user.username}})</option>
                        {% endif %}
                      {% endfor %}
                      <option value="-">* {{ lang.no_mobile_examination }}</option>
                    </select>
                  </div>
                  {% endif %}
              </div>
              <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">{{ lang.close }}</button>
              {% if entry.case_status == "1" %}
              <button type="submit" class="btn btn-success"><i class="fa fa-save"></i> {{ lang.save }}</button>
              {% elseif entry.case_status == "2" %}
              <button type="submit" class="btn btn-success"><i class="fa fa-save"></i> {{ lang.update }}</button>
              {% endif %}
              <input type="hidden" name="case_request_description" value="{{ entry.case_request_description }}">
              <input type="hidden" name="case_crime" value="{{ entry.case_crime }}">
              <input type="hidden" name="classification" value="{{ entry.classification }}">
              <input type="hidden" name="case_file_number" value="{{ entry.case_file_number }}">
              <input type="hidden" name="case_urgency" value="{{ entry.case_urgency }}">
              <input type="hidden" name="case_investigator" value="{{ entry.case_investigator }}">
              <input type="hidden" name="case_investigation_lead" value="{{ entry.case_investigation_lead }}">
              <input type="hidden" name="case_investigator_tel" value="{{ entry.case_investigator_tel }}">
              <input type="hidden" name="case_investigator_unit" value="{{ entry.case_investigator_unit }}">
              <input type="hidden" name="case_confiscation_date" value="{{ entry.case_confiscation_date }}">
              <input type="hidden" name="case_suspect" value="{{ entry.case_suspect }}">
              <input type="hidden" name="case_name" value="{{ entry.case_name }}">
              <input type="hidden" name="case_contains_mob_dev" value="{{ entry.case_contains_mob_dev }}">
              </form>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        <h2 id="examination_request" class="panel-header">&nbsp;{% if entry.case_status == "1" %}<i style="color:red;" class="fa fa-pause"></i>{% endif %}{% if entry.case_status == "2" %}<i style="color:#666;" class="fa fa-square-o"></i>{% endif %}{% if entry.case_status == "3" %}<i style="color:green;" class="fa fa-check-square-o"></i>{% endif %} {{ entry.case_id }}/{{ entry.case_added_date|date("Y") }} {% if entry.case_name %}{{ entry.case_name }}{% elseif entry.case_suspect %}{{ lang.suspect_abbrev }} {{ entry.case_suspect }}{% else %}{{ lang.suspect_short }}{% endif %}
          {% if entry.case_owner %}<span class="pull-right" style="color:red;"><i class="fa fa-lock"></i></span>{% endif %}</h2>
      <table class="table table-condensed table-bordered" style=";background-color:#FFF;">
      <tr>
        <td width="100" style="white-space:nowrap;">
          {{lang.crime|capitalize}}
        </td>
        <td>
          {{ entry.case_file_number }}, {{ entry.classification }}, {{ entry.case_crime }}
          {% if samerequest_file_number %}<br><i class="fa fa-exclamation" style="color:red;"></i> <a href='index.php?search="{{ entry.case_file_number|url_encode }}"'>{{ lang.requests_with_matching_complaint_number }}</a>: {% for entry in samerequest_file_number %}<a href="edit_request.php?case={{ entry.id }}">{{ entry.case_id }}/{{ entry.case_added_date|date("Y") }}</a>{% if not loop.last%}, {% endif%}{% endfor %}
          {% endif %}
        </td>
      </tr>
      <tr>
        <td width="100" style="white-space:nowrap;">
          {{ lang.target|capitalize }}
        </td>
        <td>
          <a href='index.php?search="{{ entry.case_suspect|url_encode }}"'>{{ entry.case_suspect }}</a>
        </td>
      </tr>

      <tr>
        <td width="100" style="white-space:nowrap;">
          {{ lang.head_of_investigation|capitalize }}
        </td>
        <td>
          <a href='index.php?search="{{ entry.case_investigation_lead|url_encode }}"'>{{ entry.case_investigation_lead }}</a> (<a href='index.php?search="{{ entry.case_investigator_unit|url_encode }}"'>{{ entry.case_investigator_unit }}</a>)
        </td>
      </tr>

      <tr>
        <td width="100" style="white-space:nowrap;">
          {{ lang.investigator|capitalize }}
        </td>
        <td>
          <a href='index.php?search="{{ entry.case_investigator|url_encode }}"'>{{ entry.case_investigator }}</a>, p. {{ entry.case_investigator_tel }}
        </td>
      </tr>
        {% if entry.forensic_investigator%}
        <tr>
          <td width="100" style="white-space:nowrap;">
            {{ lang.forensic_examiner_long|capitalize }}
          </td>
          <td>
            <a href='index.php?search="{{ entry.forensic_investigator|url_encode }}"'>{{ entry.forensic_investigator }}</a>
          </td>
        </tr>
        {% endif %}

        {% if entry.phone_investigator %}
        <tr>
          <td width="100" style="white-space:nowrap;">
            {{ lang.mobile_examiner_long|capitalize }}
          </td>
          <td>
            <a href='index.php?search="{{ entry.phone_investigator|url_encode }}"'>{{ entry.phone_investigator }}</a>
          </td>
        </tr>
        {% endif %}

        {% if entry.case_owner %}
        <tr>
          <td width="100" style="white-space:nowrap;">
            {{ lang.access_control }}
          </td>
          <td>
            <span style="color:green">{{ entry.case_owner|replace({";": ", "}) }}</span>
          </td>
        </tr>
        {% endif %}
        <tr>
          <td width="100" style="white-space:nowrap;">
            {{ lang.evidence_description|capitalize }}
          </td>
          <td>
          {{ entry.case_request_description }}
        </td>
      </tr>

      <tr>
        <td width="100" style="white-space:nowrap;">
          {{ lang.request_details|capitalize }}
        </td>
        <td>
        {{ entry.case_requested_action }}
      </td>
    </tr>
      <tr>
        <td width="100" style="white-space:nowrap;">
        {{ lang.urgency|capitalize }}
      </td>
      <td>
           {% if entry.case_urgency == "1" %}<b><a style="color:red;">{{ lang.urgency_urgent }}</a></b>{%endif %}{% if entry.case_urgency == "2" %}{{ lang.urgency_normal }}{%endif %}{% if entry.case_urgency == "3" %}{{ lang.urgency_can_wait }}{%endif %}{% if entry.case_urg_justification %}, <b>{{ entry.case_urg_justification }}</b>{% endif %}
         </td>
       </tr>
       <tr>
         <td width="100" style="white-space:nowrap;">
           {{ lang.request_dates|capitalize }}
         </td>
         <td>
           {{ lang.requested|capitalize }} <b>{{ entry.case_added_date|date("d.m.Y") }}</b>, {{ lang.confiscation_date }} <b>{{ entry.case_confiscation_date|date("d.m.Y") }}</b>, {{ lang.latest_update }} {% if (entry.last_updated|date("U") < settings.stalled_case|date("U")) and (entry.case_status == "2")%}<i style="color:red;" class="fa fa-moon-o"></i> <b style="color:red;">{{ entry.last_updated|date("d.m.Y") }}</b>{% else %}<b>{{ entry.last_updated|date("d.m.Y") }}</b>{% endif %}
         </td>
       </tr>

     </table>

     <table class="table col-md-12 table-bordered" style=";background-color:#FFF;">
             {% if attachment_files or filelist %}
             <iframe name="dlframe" style="visibility:hidden;display:none;"></iframe>
               <thead>
                 <th>{{lang.header_filename}}</th>
                 <th>{{lang.header_filetype}}</th>
                 <th>{{lang.header_filesize}}</th>
               </thead>
             {% for file in attachment_files %}
             <tr>
               <td><a href="get_file.php?file={{ file.id }}&ct={{ ct }}&token={{ session.user.token }}" target="dlframe">
               {% if "image" in file.type %}
               <i class="fa fa-file-image-o"></i>
               {% elseif "audio" in file.type %}
               <i class="fa fa-file-audio-o"></i>
               {% elseif "pdf" in file.type %}
               <i class="fa fa-file-pdf-o"></i>
               {% elseif "text" in file.type %}
               <i class="fa fa-file-text-o"></i>
               {% elseif "officedocument.wordprocessing" in file.type %}
               <i class="fa fa-file-word-o"></i>
               {% elseif "officedocument.spreadsheet" in file.type %}
               <i class="fa fa-file-excel-o"></i>
               {% elseif "officedocument.presentation" in file.type %}
               <i class="fa fa-file-powerpoint-o"></i>
               {% elseif "zip" in file.type %}
               <i class="fa fa-file-zip-o"></i>
               {% else %}
               <i class="fa fa-file-o"></i>
               {% endif %}
               {{file.name}}</a></td>
               {% if "image" in file.type and settings.show_thumbnails == "1" %}
                 {% else %}
               {% endif %}
               <td style="width:1px;">{{file.type}}</td>
               <td style="width:1px;white-space:nowrap;"><span class="pull-right">
                 {{filesize_calc.bytesToSize(file.size)}}
                 {% if (settings.allow_attachments == "1") and (caserow.0.case_status == "2") %}
                 <a href="submit.php?type=remove_attachment&file={{ file.id }}&token={{ session.user.token }}&ct={{ ct }}" onclick="return confirm('{{lang.file_remove_confirm}}')"><i class="fa fa-remove" style="color:red;"></i></span></a>
                 {% endif %}
               </td>
               {% endfor%}
             </tr>

             {% if filelist %}
             {% for file in filelist %}
             <tr>
              <td>
                <i class="fa fa-file-o"></i> <a href="attachments/{{ caserow.0.id }}/{{ file.filename }}" target="_BLANK">attachments/{{ caserow.0.id }}/{{ file.filename }}</a>
              </td>
            </tr>
            {% endfor %}
             {% endif %}
               {% endif %}
               {% if (settings.allow_attachments == "1") and (caserow.0.case_status == "2") %}
               <tr><td colspan="4" class="active">
               <form class="form-inline" action="upload.php" method="post" enctype="multipart/form-data">
                 <input type="hidden" name="case" value="{{caserow.0.id}}">
                 <input type="hidden" name="token" value="{{session.user.token}}">
                 <input type="hidden" name="ct" value="{{ct}}">
                   <div class="form-group">
                     <input type="file" multiple name="fileToUpload[]" id="fileToUpload" class="btn btn-default btn-xs">
                   </div>
                   <button type="submit" class="btn btn-success btn-xs"><i class="fa fa-upload"></i> {{ lang.upload_attachment }}</button>
                   <span class="pull-right">{{lang.max_attachment_size}} {{filesize_calc.bytesToSize(settings.max_attachment_size)}}, {{filesize_calc.bytesToSize(free_disk_space)}} {{ lang.free_space_left }}</span>
                 </form>
               </td></tr>
               {% endif %}
               {% if failed_uploads is defined %}
               {% for failure in session.failed_uploads %}
               <tr><td colspan="999">&nbsp;&nbsp;<span style="color:red;"><i class="fa fa-warning"></i> {{ failure }}</span></td></tr>
               {% endfor %}
               {% endif %}
             </table>
        {% if entry.case_status != "3" %}
        {% set progress_counter1 = "0" %}
        {% set progress_counter2 = "0" %}
        {% for entry in mediarow %}
        {% set jutun_vaihe = entry.device_action|split('|') %}
        {% if (jutun_vaihe.0 >= "1") and (entry.is_removed != "1") %}
        {% set progress_counter1 = (progress_counter1 + settings.device_action_count) %}
        {% set progress_counter2 = (progress_counter2 + jutun_vaihe.0) %}
        {% endif%}
        {% if (loop.last == true) and (progress_counter2 != "0") %}
        {% set current_request_progress = ((100 / progress_counter1) * progress_counter2)|round(0, "ceil") %}
        <div class="alert alert-{% if current_request_progress <= 20 %}danger{% elseif current_request_progress <= 80 %}warning{% else %}success{% endif %} col-md-12"><b>{{ current_request_progress }}% {{ lang.devices_investigated }}</b> &nbsp;&nbsp;<a href="edit_request.php?case={{ caserow.0.id }}"><i class="fa fa-refresh"></i> {{ lang.reload_hint_link}}</a> {{ lang.reload_hint }}</p></div>
        {% endif%}
        {% endfor %}
        {% endif %}

        <form class="form form-inline" role="form" method="post" action="submit.php?type=update_request_status">
          <input type="hidden" name="token" value="{{session.user.token}}">
          <input type="hidden" name="ct" value="{{ct}}">
          <a href="download_csv.php?case={{caserow.0.id}}" type="button" class="btn btn-warning"><i class="fa fa-download"></i> {{ lang.download_csv }}</a>
		  <a href="download_krf.php?case={{caserow.0.id}}" type="button" class="btn btn-warning"><i class="fa fa-download"></i> KRF </a>
          {% if caserow.0.case_status != "3" %}<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#perustiedot"><i class="fa fa-info-circle"></i> {{ lang.edit_request_details }}</button>{% endif %}

          <a href="print_sticker.php?uid={{ entry.id }}&type=examination_request" target="_BLANK" type="button" class="btn btn-info"><i class="fa fa-print"></i> {{ lang.print_sticker }}</a>
          <a type="button" class="btn btn-info" href="case_report.php?case={% for entry in caserow %}{{ entry.id }}{% endfor %}" target="_BLANK"><i class="fa fa-print"></i> {{ lang.print_report }}</a>

          <div class="form-group">
            <input type="hidden" value="{{ entry.id }}" name="returnid">
            {% set progress_counter1 = "0" %}
            {% set progress_counter2 = "0" %}
            {% if not mediarow %}
            <input type="hidden" value="1" name="case_status">
            <button type="submit" class="btn btn-danger"><i class="fa fa-save"></i> {{ lang.dismiss_request }}</button>
            {% else %}
            {% for entry in mediarow %}
            {% set jutun_vaihe = entry.device_action|split('|') %}
            {% if (jutun_vaihe.0 >= "1") and (entry.is_removed != "1") %}
            {% set progress_counter1 = (progress_counter1 + settings.device_action_count) %}
            {% set progress_counter2 = (progress_counter2 + jutun_vaihe.0) %}
            {% endif%}
            {% if (loop.last == true) and (progress_counter1 == progress_counter2) %}
            {% for entry in caserow %}
            {% if entry.case_status == "2" %}
            <input type="hidden" value="3" name="case_status">
            <button type="submit" class="btn btn-success"><i class="fa fa-save"></i> {{ lang.close_ready_request }}</button>
            {% elseif entry.case_status == "3" %}
            <input type="hidden" value="2" name="case_status">
            <button type="submit" class="btn btn-success"><i class="fa fa-save"></i> {{ lang.reopen_closed_request }}</button>
            {% endif %}
            {% endfor %}
            {% elseif (loop.last == true) and (progress_counter1 != progress_counter2) %}
            {% for entry in caserow %}
            {% if entry.case_status == "2" %}
            <!-- <input type="hidden" value="1" name="case_status">
              <button type="submit" class="btn btn-danger"><i class="fa fa-save"></i> {{ lang.dismiss_request }}</button> -->
            {% elseif entry.case_status == "1" %}
            <input type="hidden" value="2" name="case_status">
            <button type="submit" class="btn btn-warning"><i class="fa fa-save"></i> {{ lang.start_investigation }}</button>
            {% endif %}
            {% endfor %}
            {% endif %}
            {% endfor %}
            {% endif%}
        </form>
        </div>
        <hr>
        {% if caserow.0.report_notes %}
        <h3>{{ lang.examination_report }}</h3>
        {{ caserow.0.report_notes|raw }}
        <hr>
        {% endif %}
        {% if caserow.0.examiners_notes %}
        <h3>{{ lang.examiners_private_notes }}</h3>
        {{ caserow.0.examiners_notes|raw }}
        <hr>
        {% endif %}


        {% if (caserow.0.case_status == "1") %}
        {% if not mediarow %}

        <div class="col-sm-12">
          <form method="POST" class="form-inline pull-left" action="submit.php?type=set_removed_case">
            <input type="hidden" name="token" value="{{session.user.token}}">
            <input type="hidden" name="ct" value="{{ct}}">
            <div class="form-group">
              <input type="hidden" name="remove_exam_request" value="{{ caserow.0.id }}">
              <button type="submit" class="btn btn-xl btn-danger">{{ lang.delete_request }}</button>
            </div>
          </form>
        </div>


        {% endif %}
        {% endif %}



        {% set counter_no = "0" %}
        {% for entry in mediarow %}
        {% set jutun_vaihe = entry.device_action|split('|') %}{% if entry.is_removed != "1" %}
        <div class="col-md-3">
          <a href="device_memo.php?uid={{ entry.id }}"><img src="views/img/svg/{% if entry.device_type %}{{ entry.device_type|lower|replace({" ": "_", "ä": "a", "ö": "o"}) }}{% else %}tuntematon{% endif %}.svg" title="UID {{ entry.id }} {{ entry.device_type }} {{ entry.device_model }} {{ entry.device_manuf }}" width="42px" style="float:left;padding-left:10px;padding-right:10px;"></a>
          <div class="progress" style="width:{{ settings.progress_bar_size }};">
            <div class="progress-bar {{ settings.progress_bar_style }} progress-bar-{% if settings.device_action_count == jutun_vaihe.0 %}success{% elseif jutun_vaihe.0 == "1" %}danger{% elseif jutun_vaihe.0 == "0" %}info{% else %}warning{% endif %}" role="progressbar"
            aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width:{% if jutun_vaihe.0 == "0" %}100{% else %}{{ ((100 / settings.device_action_count) * jutun_vaihe.0)|round(0, "ceil") }}{% endif %}%">
            {{ ((100 / settings.device_action_count) * jutun_vaihe.0)|round(0, "ceil") }}%
          </div>
        </div>
      </div>
      {% endif %}
      {% endfor %}
      <!-- Modal -->
      <div class="modal fade" id="perustiedot" role="dialog" aria-labelledby="perustiedot">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">{{ lang.edit_request_details }}</h4>
            </div>
            <div class="modal-body">
              <!--- perustiedot -->
              <form class="form form-horizontal" role="form" method="post" action="submit.php?type=case_update&uid={{ entry.parent_id }}">
                <input type="hidden" name="token" value="{{session.user.token}}">
                <input type="hidden" name="ct" value="{{ct}}">
                <div class="form-group">
                  <label for="examination_request" class="col-sm-2 control-label">{{ lang.case_name }}</label>
                  <div class="col-sm-10">
                    <input {% if entry.case_status=="3" %}disabled{% endif %} type="text" class="form-control" id="examination_request" name="case_name" value="{{ entry.case_name }}" placeholder="{{ lang.specify_case_name }}">
                  </div>
                </div>
                <div class="form-group">
                  <label for="case_file_number" class="col-sm-2 control-label">{{ lang.crimnal_compl_number }}</label>
                  <div class="col-sm-10">
                    <input {% if entry.case_status=="3" %}disabled{% endif %} type="text" class="form-control" id="case_file_number" name="case_file_number" placeholder="{{ settings.organization_specific_prefix }}" value="{{ entry.case_file_number }}">
                  </div>
                </div>
                <div class="form-group">
                  <label for="case_crime" class="col-sm-2 control-label">{{ lang.main_offense }}</label>
                  <div class="col-sm-10">
                    <input {% if entry.case_status=="3" %}disabled{% endif %} type="text" class="form-control" id="case_crime" name="case_crime" placeholder="{{ lang.specify_main_offense }}" value="{{ entry.case_crime }}">
                  </div>
                </div>
                <div class="form-group">
                  <label for="case_crime" class="col-sm-2 control-label">{{ lang.classification }}</label>
                  <div class="col-sm-2">
                    <select style="text-align:left;" class="btn btn-default" name="classification" id="classification">
                    {% for classification in classifications %}
                    <option value="{{ classification }}" {% if entry.classification == classification %}selected{% endif %}>{{ classification }}</option>
                    {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="case_suspect" class="col-sm-2 control-label">{{ lang.suspect_short }}</label>
                  <div class="col-sm-10">
                    <input {% if entry.case_status=="3" %}disabled{% endif %} type="text" class="form-control" id="case_suspect" name="case_suspect" placeholder="{{ lang.name }}" value="{{ entry.case_suspect }}">
                  </div>
                </div>
                <div class="form-group">
                  <label for="case_investigation_lead" class="col-sm-2 control-label">{{ lang.head_of_investigation }}</label>
                  <div class="col-sm-10">
                    <input {% if entry.case_status=="3" %}disabled{% endif %} type="text" class="form-control" id="case_investigation_lead" name="case_investigation_lead" placeholder="{{ lang.head_of_investigation }}" value="{{ entry.case_investigation_lead }}">
                  </div>
                </div>
                <div class="form-group">
                  <label for="case_investigator" class="col-sm-2 control-label">{{ lang.case_investigator }}</label>
                  <div class="col-sm-10">
                    <input {% if entry.case_status=="3" %}disabled{% endif %} type="text" class="form-control" id="case_investigator" name="case_investigator" placeholder="{{ lang.name_and_rank }}" value="{{ entry.case_investigator }}">
                  </div>
                </div>
                <div class="form-group">
                  <label for="case_investigator_tel" class="col-sm-2 control-label">{{ lang.case_investigators_tel_no }}</label>
                  <div class="col-sm-10">
                    <input {% if entry.case_status=="3" %}disabled{% endif %} type="text" class="form-control" id="case_investigator_tel" name="case_investigator_tel" placeholder="{{ settings.phone_number_prefix }}xxxx" value="{{ entry.case_investigator_tel }}">
                  </div>
                </div>
                <div class="form-group">
                  <label for="case_crime" class="col-sm-2 control-label">{{ lang.unit }}</label>
                  <div class="col-sm-2">
                    <select style="text-align:left;" class="btn btn-default" name="case_investigator_unit" id="case_investigator_unit">
                      <option value="" disabled>{{ lang.investigating_unit }}</option>
                      {% for yksikko in inv_units %}
                      <option value="{{ yksikko }}" {% if entry.case_investigator_unit == yksikko %}selected{% endif %}>{{ yksikko }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="case_request_description" class="col-sm-2 control-label">{{ lang.description }}</label>
                  <div class="col-sm-10">
                    <input {% if entry.case_status=="3" %}disabled{% endif %} type="text" class="form-control" id="case_request_description" name="case_request_description" placeholder="{{ lang.evidence_description }}" value="{{ entry.case_request_description }}">
                  </div>
                </div>
                <div class="form-group {% if (settings.notify_after_4_months == " 1 ") and (entry.case_confiscation_date != " 0000-00-00 ") and ((entry.case_confiscation_date|date("U ")) < ("-4 months "|date("U "))) %}has-error{%endif%}">
                <label for="case_confiscation_date" class="col-sm-2 control-label">{{ lang.confiscation_date_abbrev }}</label>
                <div class="col-sm-10">
                  <input {% if entry.case_status=="3" %}disabled{% endif %} type="text" class="form-control warning" id="case_confiscation_date" name="case_confiscation_date" placeholder="{{ lang.date_format }}" value="{{ entry.case_confiscation_date }}">
                </div>
            </div>
            <div class="form-group">
            <label for="forensic_investigator" class="col-sm-2 control-label"><a style="color:green;">{{ lang.forensic_examiner_long }}</a></label>
            <div class="col-sm-10">
            <select style="text-align:left;" class="btn btn-default" name="forensic_investigator" id="forensic_investigator">
            {% if not entry.forensic_investigator %}<option selected disabled value =""></option>{% endif %}

            {% for user in session.all_users %}
              {% if 'F' in user.flags == true %}
                <option {% if user.name == entry.forensic_investigator %}selected{% endif %} value="{{ user.name }}">{{ user.name }} ({{user.username}})</option>
              {% endif %}
            {% endfor %}
            <option value="-">* {{ lang.mobile_examination_only }}</option>


            </select>
            </div>
            </div>
            <div class="form-group">
            <label for="phone_investigator" class="col-sm-2 control-label"><a style="color:green;">{{ lang.mobile_examiner_long }}</a></label>
            <div class="col-sm-10">
            <input type="hidden" name="phone_investigator" value="">
            <select style="text-align:left;" class="btn btn-default" name="phone_investigator" id="phone_investigator">
            {% if not entry.phone_investigator %}<option selected disabled value=""></option>{% endif %}

            {% for user in session.all_users %}
              {% if 'M' in user.flags == true %}
                <option {% if user.name == entry.phone_investigator %}selected{% endif %} value="{{ user.name }}">{{ user.name }} ({{user.username}})</option>
              {% endif %}
            {% endfor %}
            <option value="-">* {{ lang.no_mobile_examination }}</option>

            </select>
            </div>
            </div>
            <div class="form-group">
            <div class="col-sm-10 col-sm-offset-2">
            <input type="hidden" name="case_contains_mob_dev" value="0">
            <input {% if entry.case_status=="3" %}disabled{% endif %} type="checkbox" name="case_contains_mob_dev" value="1" {% if entry.case_contains_mob_dev=="1" %}checked{%endif%}> {{ lang.contains_mobile_devices }}
            </div>
            </div>
            <div class="form-group">
            <label for="case_urgency" class="col-sm-2 control-label"><a style="color:green;">{{ lang.urgency }}</a></label>
            <div class="col-sm-10">
            <select style="text-align:left;" class="btn btn-default" name="case_urgency" id="case_urgency">
            <option value="1" {% if entry.case_urgency == "1" %}selected{% endif %}>{{ lang.urgency_urgent }}</option>
            <option value="2" {% if entry.case_urgency == "2" %}selected{% endif %}>{{ lang.urgency_normal }}</option>
            <option value="3" {% if entry.case_urgency == "3" %}selected{% endif %}>{{ lang.urgency_can_wait }}</option>
            </select>
            </div>
            </div>
            <input type="hidden" name="is_removed" value="{{ entry.is_removed }}">
            <input type="hidden" name="parent_id" value="{{ entry.id }}">
            <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
            </div>
            </div>
          </div>
          <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">{{ lang.close }}</button>
          {% if entry.case_status == "1" %}
          <button type="submit" class="btn btn-success"><i class="fa fa-save"></i> {{ lang.save_case_details }}</button>
          {% elseif entry.case_status == "2" %}
          <button type="submit" class="btn btn-success"><i class="fa fa-save"></i> {{ lang.update_case_details }}</button>
          {% endif %}
          </form>
          {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
<div role="tabpanel" class="tab-pane{% if returntab == "devices" %} active{% endif %}" id="tab-devices">
  <div class="form-group">
  <!-- Button trigger modal -->
  {% if (caserow.0.case_status == "2") or ((caserow.0.case_status == "1") and (caserow.0.phone_investigator != "")) %}
  <button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#add_device_media_modal">
  <i class="fa fa-plus"></i> {{ lang.add_device_or_media }}
  </button>{% endif %}
</div>
{% if not mediarow %}
<h1 class="page-header">{{ lang.no_devices_add_device }}</h1>
{% endif %}
{% if mediarow %}
<div class="pull-right">{{ lang.sorted_by }}:
  {% if sort_order == "id" %}<b><i class="fa fa-sort"></i> {{ lang.sort_label_UID }}</b>{% else %}<a href="edit_request.php?case={{ caserow.0.id }}&tab=devices&j=id{% if dev_owner %}&dev_owner={{ dev_owner|url_encode }}{% endif %}">{{ lang.sort_label_UID }}</a>{% endif %} |
  {% if sort_order == "device_type" %}<b><i class="fa fa-sort"></i> {{ lang.sort_label_type }}</b>{% else %}<a href="edit_request.php?case={{ caserow.0.id }}&tab=devices&j=type{% if dev_owner %}&dev_owner={{ dev_owner|url_encode }}{% endif %}">{{ lang.sort_label_type }}</a>{% endif %} |
  {% if sort_order == "device_manuf" %}<b><i class="fa fa-sort"></i> {{ lang.sort_label_brand }}</b>{% else %}<a href="edit_request.php?case={{ caserow.0.id }}&tab=devices&j=dev_manuf{% if dev_owner %}&dev_owner={{ dev_owner|url_encode }}{% endif %}">{{ lang.sort_label_brand }}</a>{% endif %} |
  {% if sort_order == "device_model" %}<b><i class="fa fa-sort"></i> {{ lang.sort_label_model }}</b>{% else %}<a href="edit_request.php?case={{ caserow.0.id }}&tab=devices&j=dev_model{% if dev_owner %}&dev_owner={{ dev_owner|url_encode }}{% endif %}">{{ lang.sort_label_model }}</a>{% endif %} |
  {% if sort_order == "device_owner" %}<b><i class="fa fa-sort"></i> {{ lang.sort_label_owner }}</b>{% else %}<a href="edit_request.php?case={{ caserow.0.id }}&tab=devices&j=dev_owner{% if dev_owner %}&dev_owner={{ dev_owner|url_encode }}{% endif %}">{{ lang.sort_label_owner }}</a>{% endif %} |
  {% if sort_order == "device_location" %}<b><i class="fa fa-sort"></i> {{ lang.sort_label_location }}</b>{% else %}<a href="edit_request.php?case={{ caserow.0.id }}&tab=devices&j=dev_location{% if dev_owner %}&dev_owner={{ dev_owner|url_encode }}{% endif %}">{{ lang.sort_label_location }}</a>{% endif %} |
  {% if sort_order == "device_action" %}<b><i class="fa fa-sort"></i> {{ lang.sort_label_status }}</b>{% else %}<a href="edit_request.php?case={{ caserow.0.id }}&tab=devices&j=device_action{% if dev_owner %}&dev_owner={{ dev_owner|url_encode }}{% endif %}">{{ lang.sort_label_status }}</a>{% endif %} |
  {% if sort_order == "device_document, device_item_number" %}<b><i class="fa fa-sort"></i> {{ lang.device_document }}</b>{% else %}<a href="edit_request.php?case={{ caserow.0.id }}&tab=devices&j=tvp{% if dev_owner %}&dev_owner={{ dev_owner|url_encode }}{% endif %}">{{ lang.device_document }}</a>{% endif %}
</div>
{% endif %}
{% for entry in mediarow %}
<a name="{{ entry.id }}"></a>
{% if (entry.device_host_id == "0") and (entry.is_removed != "1") %}
{% set isanta_id = entry.id %}
<table class="table table-condensed" style="border: {% if dev_owner and (entry.device_owner == dev_owner) %}{% set korostus = True %}1px solid #F00{% else %}1px solid #AAA{% endif %};background-color:#FFF;">

  <thead style="background-color:{% if dev_owner and (entry.device_owner == dev_owner) %}#FCC{% else %}#CDE{% endif %};">
    <th style="width:1px;" class="text-center"><i class="fa fa-cube"></i></th>
    <th style="width:350px">{{ lang.device_or_media }}</th>
    <th>{{ lang.info }}</th>
    <th style="width:1px"></th>
  </thead>

  <tr class="active">
    <td style="vertical-align:middle;" {% if entry.device_contains_evidence %}class="success"{% endif %}>
    <img src="views/img/svg/{% if entry.device_type %}{{ entry.device_type|lower|replace({" ": "_", "ä": "a", "ö": "o"}) }}{% else %}{{ lang.unknown }}{% endif %}.svg"  style="vertical-align:middle;float:left;padding:10px;width:64px;">
    </td>
    <td style="vertical-align:middle;white-space:nowrap;" {% if entry.device_contains_evidence %}class="success"{% endif %}>
      <h4><a href="device_memo.php?uid={{ entry.id }}">{% if entry.device_type %}{{ entry.device_type }}{% else %}<span style="color:red;">{{ lang.undefined_device_or_media_type }}</span>{% endif %}<br>
        {{ entry.device_manuf }} {{ entry.device_model }} {% if entry.device_size_in_gb > "0" %}{{ entry.device_size_in_gb }} GB{% endif %}</a><br>
        <small>
            <a href="print_sticker.php?uid={{entry.id}}&type=device" target="_BLANK"><i class="fa fa-print"></i> [UID{{ entry.id }}]</a>, {{ entry.device_document }} {{ lang.object_no }} {{ entry.device_item_number }}<br>
          {{ lang.added }} {{ entry.case_added_date|date("d.m.Y H:i") }}{% if entry.case_added_date != entry.last_updated %}<br>{{ lang.updated|capitalize }} {{ entry.last_updated|date("d.m.Y H:i") }}{% endif %}
        {% if entry.report_notes %}<br>
        {% if entry.device_include_in_report == "1" %}
        <span style="color:green;"><i class="fa fa-check-square-o"></i> {{ lang.examination_notes_shown }}</span><br>
        {% endif %}
        {% if entry.device_include_in_report == "0" %}
        <span style="color:red;"><i class="fa fa-close"></i> {{ lang.examination_notes_hidden }}</span><br>
        {% endif %}
        {% else %}<br><span style="color:orange;"><i class="fa fa-square-o"></i> {{ lang.examination_notes_empty }}</span><br>
        {% endif %}
        {% if entry.device_contains_evidence %}
        <span style="color:green;"><i class="fa fa-search"></i> {{ lang.contains_evidence }}</span><br>
        {% endif %}
        </small>
      </h4>
      {% set check = "0" %}
      {% for test in mediarow if test.device_host_id == entry.id and test.is_removed == "0" %}
      {% set check = "1" %}
      {% else %}
      {% for media in media_objs if (entry.device_type == media) and (check != "1") %}
      <form class="form form-inline" role="form" method="post" action="submit.php?type=device_attach&uid={{ entry.id }}&returnid={{ entry.parent_id }}">
        <input type="hidden" name="token" value="{{session.user.token}}">
        <input type="hidden" name="ct" value="{{ct}}">
        <select style="text-align:left;" class="btn btn-xs btn-default" name="isanta">
          <option selected disabled value="0">{{ lang.associate_with_device }}</option>
          {% for target in mediarow %}
          {% if (target.is_removed == "0") and (target.device_host_id == "0") and (target.id != entry.id) %}
          {% set valinta = ("[UID " ~ target.id ~ "] " ~ target.device_type ~ " " ~ target.device_manuf) %}
          <option value="{{ target.id }}">{{ valinta|length > 27 ? valinta|slice(0, 27) ~ '...' : valinta }}</a>
          </option>
          {% endif %}
          {% endfor %}
        </select>
        <button type="submit" class="btn btn-xs btn-default"><span class="glyphicon glyphicon-link" aria-hidden="true"></span></button>
      </form>
      {% endfor %}
      {% endfor %}
    </td>

    <td style="vertical-align:middle;{% if entry.device_contains_evidence %}background:linear-gradient(to right, #e1f0d6 , #f5f5f5);{% endif %}">
      {% if entry.device_owner %}
      {% if dev_owner == entry.device_owner %}<i class="fa fa-user"></i> <a href="edit_request.php?case={{ caserow.0.id }}&tab=devices{% if j %}&j={{ j }}{% endif %}#{{ entry.id }}">{{ entry.device_owner }} <span class="pull-right"><i class="fa fa-remove"></i> {{ lang.remove_accent }}</a>{% else %}<i class="fa fa-user"></i> <a href="edit_request.php?case={{ caserow.0.id }}&tab=devices{% if j %}&j={{ j }}{% endif%}&dev_owner={{ entry.device_owner|url_encode }}#{{ entry.id }}">{{ entry.device_owner }}</a></span>{% endif %}<br>
      {% set hosting_dev_owner = entry.device_owner %}
      {% else %}
      <span style="color:red;"> <i class="fa fa-exclamation-triangle"></i> {{ lang.owner_info_missing }}</span><br>
      {% endif %}
      {% if entry.case_request_description %}
      <i class="fa fa-info-circle"></i> {{ entry.case_request_description }}<br>
      {% endif %}
      {% if entry.device_os %}
      {% if "windows" in entry.device_os|lower %}<i class="fa fa-windows"></i>
      {% elseif "linux" in entry.device_os|lower or "debian" in entry.device_os|lower or "ubuntu" in entry.device_os|lower or "arch" in entry.device_os|lower or "red hat" in entry.device_os|lower %}<i class="fa fa-linux"></i>
      {% elseif "os x" in entry.device_os|lower or "apple" in entry.device_os|lower or "ios" in entry.device_os|lower or "macos" in entry.device_os|lower or "tvos" in entry.device_os|lower %}<i class="fa fa-apple"></i>
      {% elseif "android" in entry.device_os|lower %}<i class="fa fa-android"></i>
      {% elseif "chrome" in entry.device_os|lower %}<i class="fa fa-chrome"></i>
      {% else %}<i class="fa fa-mouse-pointer"></i>{% endif %} {{ entry.device_os }}<br>
      {% endif %}
      {% if entry.device_time_deviation %}
      <i class="fa fa-clock-o"></i> {{ entry.device_time_deviation }}<br>
      {% endif %}
      {% if entry.device_identifier %}
      <i class="fa fa-barcode"></i> {{ entry.device_identifier }}<br>
      {% endif %}
    </td>

    <td style="vertical-align:middle;align:left;">
      <form class="form form-horizontal" role="form" method="post" action="submit.php?type=change_device_status&uid={{ entry.id }}" target="submit_iframe{{entry.id}}">
        <input type="hidden" name="token" value="{{session.user.token}}">
        <input type="hidden" name="ct" value="{{ct}}">
      {% if (caserow.0.case_status != 3) and (session.user.access <= 1) %}
    <p>  <select style="text-align:left;width:200px;" class="btn btn-{% if not entry.device_action %}danger{% else %}default{% endif %}" name="device_action" onchange="this.form.submit()">
      <option value="{{entry.device_action}}" selected="selected">{% set device_current_action = entry.device_action|split('|') %}{{device_current_action.1}}</option>
      <option disabled>---</option>
      {% for dev_act in device_actions %}
      {% set device_current_action = dev_act|split('|') %}
      <option value="{{dev_act}}">{{device_current_action.1}} </option>
      {% endfor %}
    </select>​</p>
      {% else %}
      {% set show_action_status = entry.device_action|split('|') %}
      <div style="width:100px;">{{ show_action_status.1 }}</div>
      <input type="hidden" name="device_action" value="{{ entry.device_action }}">
      {% endif %}
      </form>
      <p><form class="form form-horizontal" role="form" method="post" action="submit.php?type=change_device_location&uid={{ entry.id }}" target="submit_iframe{{entry.id}}_void">
        <input type="hidden" name="token" value="{{session.user.token}}">
        <input type="hidden" name="ct" value="{{ct}}">
      <select style="text-align:left;width:200px;" class="btn btn-{% if not entry.device_location %}danger{% else %}default{% endif %}" name="device_location" {% if session.user.access > 1 %}disabled{% else %}onchange="this.form.submit()"{% endif %}>
      <option value="{{entry.device_location}}" selected="selected">{{entry.device_location}}</option>
      <option disabled>---</option>
      {% for dev_loc in device_locations %}
      <option value="{{dev_loc}}">{{dev_loc}}</option>
      {% endfor %}
      </select>​
    </form></p>
    <p><iframe name="submit_iframe{{entry.id}}" allowtransparency="true" style="overflow:hidden; width:200px; height:16px; border:0px solid red; margin: 0 auto; display:block;" src="progress_bar_static.php?uid={{entry.id}}"></iframe></p>
    <iframe name="submit_iframe{{entry.id}}_void" style="display:none;"></iframe></p>
    </td>
  </tr>

  {% for entry in mediarow %}
  {% if (entry.device_host_id == isanta_id) and (entry.is_removed != "1") %}
  <a name="{{ entry.id }}"></a>
  <tr>
    <td style="vertical-align:middle;" {% if entry.device_contains_evidence %}class="success"{% endif %}>
    <img src="views/img/svg/{% if entry.device_type %}{{ entry.device_type|lower|replace({" ": "_", "ä": "a", "ö": "o"}) }}{% else %}tuntematon{% endif %}.svg"  style="vertical-align:middle;float:left;padding:10px;width:64px;">
    </td>
    <td style="vertical-align:middle;white-space:nowrap;" {% if entry.device_contains_evidence %}class="success"{% endif %}>
      <h4><a href="device_memo.php?uid={{ entry.id }}">{% if entry.device_type %}{{ entry.device_type }}{% else %}<span style="color:red;">{{ lang.undefined_device_or_media_type }}</span>{% endif %}<br>
        {{ entry.device_manuf }} {{ entry.device_model }} {% if entry.device_size_in_gb > "0" %}{{ entry.device_size_in_gb }} GB{% endif %}</a><br>
        <small>
          <a href="print_sticker.php?uid={{entry.id}}&type=device" target="_BLANK"><i class="fa fa-print"></i> [UID{{ entry.id }}]</a>, {{ entry.device_document }} {{ lang.object_no }} {{ entry.device_item_number }}<br>
          {{ lang.added }} {{ entry.case_added_date|date("d.m.Y H:i") }}{% if entry.case_added_date != entry.last_updated %}<br>{{ lang.updated|capitalize }} {{ entry.last_updated|date("d.m.Y H:i") }}{% endif %}
        {% if entry.report_notes %}<br>
        {% if entry.device_include_in_report == "1" %}
        <span style="color:green;"><i class="fa fa-check-square-o"></i> {{ lang.examination_notes_shown }}</span><br>
        {% endif %}
        {% if entry.device_include_in_report == "0" %}
        <span style="color:red;"><i class="fa fa-close"></i> {{ lang.examination_notes_hidden }}</span><br>
        {% endif %}
        {% else %}<br><span style="color:orange;"><i class="fa fa-square-o"></i> {{ lang.examination_notes_empty }}</span><br>
        {% endif %}
        {% if entry.device_contains_evidence %}
        <span style="color:green;"><i class="fa fa-search"></i> {{ lang.contains_evidence }}</span><br>
        {% endif %}
        </small>
      </h4>
      <a href="submit.php?type=device_detach&uid={{ entry.id }}&returnid={{ entry.parent_id }}&token={{session.user.token}}" onclick="return confirm('{{ lang.remove_association_warning }}')"><i class="fa fa-unlink"></i> {{ lang.remove_association }}</a>
    </td>
    <td style="vertical-align:middle;{% if entry.device_contains_evidence %}background:linear-gradient(to right, #e1f0d6 , #ffffff);{% endif %}">
      {% if hosting_dev_owner != entry.device_owner %}<span style="color:darkred;"><i class="fa fa-user"></i> {{ entry.device_owner }} {{ lang.different_owner }}</span><br>{% endif %}
      {% if entry.case_request_description %}
      <i class="fa fa-info-circle"></i> {{ entry.case_request_description }}<br>
      {% endif %}
      {% if entry.device_os %}
      {% if "windows" in entry.device_os|lower %}<i class="fa fa-windows"></i>
      {% elseif "linux" in entry.device_os|lower or "debian" in entry.device_os|lower or "ubuntu" in entry.device_os|lower or "arch" in entry.device_os|lower or "red hat" in entry.device_os|lower %}<i class="fa fa-linux"></i>
      {% elseif "os x" in entry.device_os|lower or "apple" in entry.device_os|lower or "ios" in entry.device_os|lower or "macos" in entry.device_os|lower or "tvos" in entry.device_os|lower %}<i class="fa fa-apple"></i>
      {% elseif "android" in entry.device_os|lower %}<i class="fa fa-android"></i>
      {% elseif "chrome" in entry.device_os|lower %}<i class="fa fa-chrome"></i>
      {% else %}<i class="fa fa-mouse-pointer"></i>{% endif %} {{ entry.device_os }}<br>
      {% endif %}
      {% if entry.device_time_deviation %}
      <i class="fa fa-clock-o"></i> {{ entry.device_time_deviation }}<br>
      {% endif %}
      {% if entry.device_identifier %}
      <i class="fa fa-barcode"></i> {{ entry.device_identifier }}<br>
      {% endif %}
    </td>
    <td style="vertical-align:middle;align:left;">
      <form class="form form-horizontal" role="form" method="post" action="submit.php?type=change_device_status&uid={{ entry.id }}" target="submit_iframe{{entry.id}}">
        <input type="hidden" name="token" value="{{session.user.token}}">
<input type="hidden" name="ct" value="{{ct}}">
      {% if (caserow.0.case_status != 3) and (session.user.access <= 1) %}
    <p>  <select style="text-align:left;width:200px;" class="btn btn-{% if not entry.device_action %}danger{% else %}default{% endif %}" name="device_action" onchange="this.form.submit()">
      <option value="{{entry.device_action}}" selected="selected">{% set device_current_action = entry.device_action|split('|') %}{{device_current_action.1}}</option>
      <option disabled>---</option>
      {% for dev_act in device_actions %}
      {% set device_current_action = dev_act|split('|') %}
      <option value="{{dev_act}}">{{device_current_action.1}} </option>
      {% endfor %}
    </select>​</p>
      {% else %}
      {% set show_action_status = entry.device_action|split('|') %}
      <div style="width:100px;">{{ show_action_status.1 }}</div>
      <input type="hidden" name="device_action" value="{{ entry.device_action }}">
      {% endif %}
      </form>
      <p><form class="form form-horizontal" role="form" method="post" action="submit.php?type=change_device_location&uid={{ entry.id }}" target="submit_iframe{{entry.id}}_void">
        <input type="hidden" name="token" value="{{session.user.token}}">
        <input type="hidden" name="ct" value="{{ct}}">
      <select style="text-align:left;width:200px;" class="btn btn-{% if not entry.device_location %}danger{% else %}default{% endif %}" name="device_location" {% if session.user.access > 1 %}disabled{% else %}onchange="this.form.submit()"{% endif %}>
      <option value="{{entry.device_location}}" selected="selected">{{entry.device_location}}</option>
      <option disabled>---</option>
      {% for dev_loc in device_locations %}
      <option value="{{dev_loc}}">{{dev_loc}}</option>
      {% endfor %}
      </select>​
    </form></p>
    <p><iframe name="submit_iframe{{entry.id}}" allowtransparency="true" style="overflow:hidden; width:200px; height:16px; border:0px solid red; margin: 0 auto; display:block;" src="progress_bar_static.php?uid={{entry.id}}"></iframe></p>
    <iframe name="submit_iframe{{entry.id}}_void" style="display:none;"></iframe></p>
    </td>
  </tr>

  {% endif %}
  {% endfor %}
  {% if (caserow.0.case_status == "2") or ((caserow.0.case_status == "1") and (caserow.0.phone_investigator != "")) %}
  <tr>
    <td></td>
    <td colspan="3">
      <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#add_media_modal_{{ entry.id }}"><i class="fa fa-plus"></i> {{ lang.add_an_assoc_media }}</button>
    </td>
  </tr>
  {% endif %}
</table>

<!-- Button trigger modal -->
<!-- Modal -->
<div class="modal fade" id="add_media_modal_{{ entry.id }}" role="dialog" aria-labelledby="add_media_modal_{{ entry.id }}">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">{{ lang.add_media }} | {{ entry.device_type }} {{ entry.device_manuf }} {{ entry.device_model }}</h4>
      </div>
      <div class="modal-body">
        <form class="form" role="form" method="post" action="submit.php?type=device">
          <input type="hidden" name="token" value="{{session.user.token}}">
          <input type="hidden" name="ct" value="{{ct}}">
          <div class="form-group">
            <select style="text-align:left;" class="btn btn-default" name="device_type" id="device_type_2">
              <option selected disabled>{{ lang.choose_media_type }}:</option>
              {% for entry in media_objs %}
              <option value="{{ entry }}">{{ entry }}</option>
              {% endfor %}
            </select><span style="color:red;font-size:1.2em">&nbsp;*</span>
          </div>
          <div class="form-group">
            <select style="text-align:left;" class="btn btn-default" name="device_action" id="device_action">
              <option selected disabled>{{ lang.action_status }}</option>
              {% for entry in device_actions %}
              {% if entry == ""%}
              <option disabled>----</option>
              {% else %}
              <option value="{{ entry }}">{% set jutun_vaihe = entry|split('|') %}{{ jutun_vaihe.1 }}</option>
              {% endif %}
              {% endfor %}
            </select><span style="color:red;font-size:1.2em">&nbsp;*</span>
          </div>
          <div class="form-group">
            <select style="text-align:left;" class="btn btn-default" name="device_location" id="device_location">
              <option selected disabled>{{ lang.location }}</option>
              {% for entry in device_locations %}
              <option value="{{ entry }}">{{ entry }}</option>
              {% endfor %}
            </select><span style="color:red;font-size:1.2em">&nbsp;*</span>
          </div>
          <div class="form-group">
            <label class="sr-only" for="device_manuf">{{ lang.sort_label_brand }}</label>
            <input type="text" class="form-control" id="device_manuf" name="device_manuf" placeholder="{{ lang.sort_label_brand }}" value="{% if session.cache is defined %}{{ session_cache.device_manuf }}{% endif %}">
          </div>
          <div class="form-group">
            <label class="sr-only" for="device_model">{{ lang.sort_label_model }}</label>
            <input type="text" class="form-control" id="device_model" name="device_model" placeholder="{{ lang.sort_label_model }}" value="{% if session.cache is defined %}{{ session_cache.device_model }}{% endif %}">
          </div>
          <div class="form-group">
            <label class="sr-only" for="device_size_in_gb">{{ lang.size_in_gb_long }}</label>
            <input type="text" class="form-control" id="device_size_in_gb" name="device_size_in_gb" placeholder="{{ lang.size_in_gb_long }}" value="{% if session.cache is defined %}{{ session_cache.device_size_in_gb }}{% endif %}" onKeyPress="return numbersonly(this, event)">
          </div>
          <div class="form-group">
            <label class="sr-only" for="device_owner">{{ lang.sort_label_owner }}</label>
            <input type="text" class="form-control" id="device_owner" name="device_owner" placeholder="{{ lang.sort_label_owner }}" value="{{ entry.device_owner }}" value="{% if session.cache is defined %}{{ session_cache.device_owner }}{% endif %}">
          </div>
          <div class="form-group">
            <input type="text" class="form-control" id="device_os" name="device_os" placeholder="{{ lang.operating_system_long }}" value="{% if session.cache is defined %}{{ session_cache.device_os }}{% endif %}">
          </div>
          <div class="form-group">
            <input type="text" class="form-control" id="device_time_deviation" name="device_time_deviation" placeholder="{{ lang.time_deviation }}" value="{% if session.cache is defined %}{{ session_cache.device_time_deviation }}{% endif %}">
          </div>
          <div class="form-group">
            <label class="sr-only" for="case_request_description">Kuvaus</label>
            <input type="text" class="form-control" id="case_request_description" name="case_request_description" placeholder="{{ lang.device_description }}" value="{% if session.cache is defined %}{{ session_cache.case_request_description }}{% endif %}">
          </div>
          <div class="form-group">
            <label class="sr-only" for="device_identifier">{{ lang.device_identifier }}</label>
            <input type="text" class="form-control" id="device_identifier" name="device_identifier" placeholder="{{ lang.device_identifier }}" value="{% if session.cache is defined %}{{ session_cache.device_identifier }}{% endif %}">
          </div>
          <div class="form-group">
            <input type="text" class="form-control" id="device_item_number" name="device_item_number" placeholder="{{ lang.device_item_number }}" value="{% if session.cache is defined %}{{ session_cache.device_item_number }}{% endif %}" onKeyPress="return numbersonly(this, event)" value="{{ entry.device_item_number }}">
          </div>
          <div class="form-group">
            <input type="text" class="form-control" id="device_document" name="device_document" placeholder="{{ lang.device_document }}" value="{% if session.cache is defined %}{{ session_cache.device_document }}{% endif %}">
          </div>
          <div class="form-group">
            <input type="hidden" name="parent_id" value="{{ caserow.0.id }}">
            <input type="hidden" name="is_removed" value="0">
            <input type="hidden" value="{% if entry.id %}{{ entry.id }}{% else %}0{% endif %}" name="device_host_id">
          </div>
      </div>
      <div class="modal-footer">
      <button type="button" class="btn btn-default" data-dismiss="modal">{{ lang.close }}</button>
      <button id="save_button_2" type="submit" class="btn btn-success"><i class="fa fa-save"></i> {{ lang.save }}</button>
      </form>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endfor %}
<!-- Modal -->
<div class="modal fade" id="add_device_media_modal" role="dialog" aria-labelledby="add_device_media_modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">{{ lang.add_new_device_or_media }}</h4>
      </div>
      <div class="modal-body">
        <form class="form" role="form" method="post" action="submit.php?type=device">
          <input type="hidden" name="token" value="{{session.user.token}}">
          <input type="hidden" name="ct" value="{{ct}}">
          <div class="form-group">
            <select style="text-align:left;" class="btn btn-default" name="device_type" id="device_type_1">
              <option selected disabled>{{ lang.device_type }}</option>
              {% for entry in devices %}
              <option value="{{ entry }}">{{ entry }}</option>
              {% endfor %}
              <option disabled value="">&nbsp;&nbsp;{{ lang.medias }}:</option>
              {% for entry in media_objs %}
              <option value="{{ entry }}">{{ entry }}</option>
              {% endfor %}
            </select><span style="color:red;font-size:1.2em">&nbsp;*</span>
          </div>
          <div class="form-group">
            <select style="text-align:left;" class="btn btn-default" name="device_action" id="device_action">
              <option selected disabled>{{ lang.action_status }}</option>
              {% for entry in device_actions %}
              {% if entry == ""%}
              <option disabled>----</option>
              {% else %}
              <option value="{{ entry }}">{% set jutun_vaihe = entry|split('|') %}{{ jutun_vaihe.1 }}</option>
              {% endif %}
              {% endfor %}
            </select><span style="color:red;font-size:1.2em">&nbsp;*</span>
          </div>
          <div class="form-group">
            <select style="text-align:left;" class="btn btn-default" name="device_location" id="device_location">
              <option selected disabled>{{ lang.device_location }}</option>
              {% for entry in device_locations %}
              <option value="{{ entry }}">{{ entry }}</option>
              {% endfor %}
            </select><span style="color:red;font-size:1.2em">&nbsp;*</span>
          </div>
          <div class="form-group">
            <label class="sr-only" for="device_manuf">{{ lang.sort_label_brand }}</label>
            <input type="text" class="form-control" id="device_manuf" name="device_manuf" placeholder="{{ lang.sort_label_brand }}" value="{% if session.cache is defined %}{{ session_cache.device_manuf }}{% endif %}">
          </div>
          <div class="form-group">
            <label class="sr-only" for="device_model">{{ lang.sort_label_model }}</label>
            <input type="text" class="form-control" id="device_model" name="device_model" placeholder="{{ lang.sort_label_model }}" value="{% if session.cache is defined %}{{ session_cache.device_model }}{% endif %}">
          </div>
          <div class="form-group">
            <label class="sr-only" for="device_size_in_gb">{{ lang.size_in_gb_long }}</label>
            <input type="text" class="form-control" id="device_size_in_gb" name="device_size_in_gb" placeholder="{{ lang.size_in_gb_long }}" value="{% if session.cache is defined %}{{ session_cache.device_size_in_gb }}{% endif %}" onKeyPress="return numbersonly(this, event)">
          </div>
          <div class="form-group">
            <label class="sr-only" for="device_identifier">{{ lang.sort_label_owner }}</label>
            <input type="text" class="form-control" id="device_owner" name="device_owner" placeholder="{{ lang.sort_label_owner }}" value="{{ caserow.0.case_suspect }}">
          </div>
          <div class="form-group">
            <input type="text" class="form-control" id="device_os" name="device_os" placeholder="{{ lang.operating_system_long }}" value="{% if session.cache is defined %}{{ session_cache.device_os }}{% endif %}">
          </div>
          <div class="form-group">
            <input type="text" class="form-control" id="device_time_deviation" name="device_time_deviation" placeholder="{{ lang.time_deviation }}" value="{% if session.cache is defined %}{{ session_cache.device_time_deviation }}{% endif %}">
          </div>
          <div class="form-group">
            <label class="sr-only" for="case_request_description">{{ lang.description }}</label>
            <input type="text" class="form-control" id="case_request_description" name="case_request_description" placeholder="{{ lang.device_description }}" value="{% if session.cache is defined %}{{ session_cache.case_request_description }}{% endif %}">
          </div>
          <div class="form-group">
            <label class="sr-only" for="device_identifier">{{ lang.device_identifier }}</label>
            <input type="text" class="form-control" id="device_identifier" name="device_identifier" placeholder="{{ lang.device_identifier_serial }}" value="{% if session.cache is defined %}{{ session_cache.device_identifier }}{% endif %}">
          </div>
          <div class="form-group">
            <input type="text" class="form-control" id="device_item_number" name="device_item_number" placeholder="{{ lang.device_item_number }}" onKeyPress="return numbersonly(this, event)" value="{% if session.cache is defined %}{{ session_cache.device_item_number }}{% endif %}">
          </div>
          <div class="form-group">
            <input type="text" class="form-control" id="device_document" name="device_document" placeholder="{{ lang.device_document }}" value="{% if session.cache is defined %}{{ session_cache.device_document }}{% endif %}">
          </div>
          <div class="form-group">
            <input type="hidden" name="parent_id" value="{{ caserow.0.id }}">
            <input type="hidden" name="is_removed" value="0">
            <input type="hidden" name="device_host_id" value="0">
          </div>
      </div>
      <div class="modal-footer">
      <button type="button" class="btn btn-default" data-dismiss="modal">{{ lang.close }}</button>
      <button id="save_button_1" type="submit" class="btn btn-success"><i class="fa fa-save"></i> {{ lang.save }}</button>
      </form>
      </div>
    </div>
  </div>
</div>
{% if mediarow %}
<form class="form form-inline pull-right" role="form" method="post" action="submit.php?type=move_all&returnid={{ caserow.0.parent_id }}">
  <input type="hidden" name="token" value="{{session.user.token}}">
  <input type="hidden" name="ct" value="{{ct}}">
  {% if caserow.0.case_status != "3" %}
  <select style="text-align:left;" class="btn btn-xs btn-default" name="device_action" id="device_action">
    <option value="NO_CHANGE" selected>{{ lang.sort_label_status }}</option>
    <option value="NO_CHANGE" disabled>----</option>
    {% for entry in device_actions %}
    <option value="{{ entry }}">{% set jutun_vaihe = entry|split('|') %}{{ jutun_vaihe.1 }}</option>
    {% endfor %}
  </select>
  {% else %}
  <input type="hidden" name="device_action" value="NO_CHANGE">
  {% endif %}
  <select style="text-align:left;" class="btn btn-xs btn-default" name="device_location" id="device_location">
    <option value="NO_CHANGE" selected>{{ lang.sort_label_location }}</option>
    <option value="NO_CHANGE" disabled>----</option>
    {% for entry in device_locations %}
    <option value="{{ entry }}">{{ entry }}</option>
    {% endfor %}
  </select>
  <td style="vertical-align:middle;">
    <button type="submit" class="btn btn-warning btn-xs"><i class="fa fa-save"></i> {{ lang.update_all }}</button>
</form>
{% endif %}
</div>
<div role="tabpanel" class="tab-pane{% if returntab == "report_notes" %} active{% endif %}" id="tab-report_notes">
  {% if (caserow.0.case_status <= "2") and (caserow.0.forensic_investigator or caserow.0.phone_investigator) %}
  <h3 class="page-heading">{{ lang.examination_report }}</h3>
  <form class="form" role="form" method="post" action="submit.php?type=report_notes">
    <input type="hidden" name="token" value="{{session.user.token}}">
    <input type="hidden" name="ct" value="{{ct}}">
  <div class="form-group form-horizontal">
  <textarea id="richeditor" class="textarea form-control" rows="25" style="height:500px;" name="report_notes">{% if caserow.0.report_notes %}{{ caserow.0.report_notes }}{% endif %}</textarea>
  </div>
  <input type="hidden" value="{{ caserow.0.parent_id }}" name="returnid">
  <div class="form-group">
  <button type="submit" class="btn btn-success"><i class="fa fa-save"></i> {{ lang.save_examination_report }}</button>
  </div>
  </form>
  {% else %}
  <div class="panel panel-default">
  <div class="panel-heading">
  <h3 id="report_notes" class="panel-title">{{ lang.examination_report }}</h3>
  </div>
  <div class="panel-body">
  {{ caserow.0.report_notes|raw }}
  </div>
  </div>
  {% endif %}
</div>

<div role="tabpanel" class="tab-pane{% if returntab == "examiners_notes" %} active{% endif %}" id="tab-examiners_notes">
  {% if (caserow.0.case_status <= "2") and (caserow.0.forensic_investigator or caserow.0.phone_investigator) %}
  <h3 class="page-heading">{{ lang.examiners_private_notes }}</h3>
  <form class="form" role="form" method="post" action="submit.php?type=examiners_notes">
    <input type="hidden" name="token" value="{{session.user.token}}">
    <input type="hidden" name="ct" value="{{ct}}">
  <div class="form-group form-horizontal">
  <textarea id="richeditor2" class="textarea form-control" rows="25" style="height:500px;" name="examiners_notes">{{ caserow.0.examiners_notes }}</textarea>
  </div>
  <input type="hidden" value="{{ caserow.0.parent_id }}" name="returnid">
  <div class="form-group">
  <button type="submit" class="btn btn-success"><i class="fa fa-save"></i> {{ lang.save_notes }}</button>
  </div>
  </form>
  {% else %}
  <div class="panel panel-default">
  <div class="panel-heading">
  <h3 id="report_notes" class="panel-title">{{ lang.examiners_private_notes }}</h3>
  </div>
  <div class="panel-body">
  {{ caserow.0.examiners_notes|raw }}
  </div>
  </div>
  {% endif %}
</div>

<div role="tabpanel" class="tab-pane{% if returntab == "access" %} active{% endif %}" id="tab-access">
{% if (caserow.0.case_status <= "2") and (caserow.0.forensic_investigator or caserow.0.phone_investigator) %}

<h3 class="page-heading">{{ lang.case_access_control }}</h3>
<table class="table table-striped" style=";background-color:#FFF;">

  <form class="form" role="form" method="post" action="submit.php?type=case_access&id={{caserow.0.id}}">
    <input type="hidden" name="token" value="{{session.user.token}}">
    <input type="hidden" name="ct" value="{{ct}}">
  <thead>
    <th style="width:1px;">{{ lang.access }}</th>
    <th>{{ lang.user }}</th>
    <th class="text-center">{{ lang.forensic_examiner_long|capitalize }}</th>
    <th class="text-center">{{ lang.mobile_examiner_long|capitalize }}</th>
  </thead>

  <tr{% if case_owner is empty %} class="success"{% else %} class="danger"{% endif %}>
    <td>
      <input type="checkbox" name="access[all_users]" value="true" {% if case_owner is empty %}checked{% endif %}>
    </td>
    <td>
      <b>{% if not case_owner %}{{ lang.no_restrictions }}{% else %}{{ lang.clear_restrictions }}{% endif %}</b>
    </td>
    <td class="text-center">
    </td>
    <td class="text-center">
    </td>

  </tr>

{% if session.user.access == "0" %}
  <tr{% if "admin" in case_owner %} class="success"{% endif %}>
    <td>
      <input type="checkbox" name="access[admin_only]" value="true" {% if "admin" in case_owner %}checked{% endif %}>
    </td>
    <td>
      <span style="color:red;">Admin only</span>
    </td>
    <td class="text-center">
    </td>
    <td class="text-center">
    </td>

  </tr>
{% endif %}

{% for user in session.all_users %}
{% if (user.username == session.user.username and user.access != "0") or caserow.0.phone_investigator == user.name or caserow.0.forensic_investigator == user.name %}
  <tr class="success">
    <td>
      <input type="hidden" name="access[{{user.username}}]" value="{{user.username}}"> <input type="checkbox" checked disabled>
    </td>
    <td>
      {{ user.name }}
    </td>
    <td class="text-center">
      {% if caserow.0.forensic_investigator == user.name %}<i style="color:green;" class="fa fa-check"></i>{% endif %}
    </td>
    <td class="text-center">
      {% if caserow.0.phone_investigator == user.name %}<i style="color:green;" class="fa fa-check"></i>{% endif %}
    </td>
  </tr>
{% endif %}
{% endfor %}

{% for user in session.all_users %}
{% if user.username != session.user.username and caserow.0.phone_investigator != user.name and caserow.0.forensic_investigator != user.name and user.access <= 2 and user.access >= 1 %}
  <tr {% if user.username not in case_owner and case_owner is not empty %}class="danger"{% endif %}{% if user.username in case_owner %} class="success"{% endif %}{% if not case_owner %} class="success"{% endif %}>
    <td>
      <input type="checkbox" name="access[{{user.username}}]" value="{{user.username}}" {% if (user.username in case_owner or caserow.0.forensic_investigator == user.name or caserow.0.phone_investigator == user.name) and (case_owner != empty) %}checked{% endif %}>
    </td>
    <td>
      {{ user.name }}
    </td>
    <td class="text-center">
      {% if caserow.0.forensic_investigator == user.name %}<i style="color:green;" class="fa fa-check"></i>{% endif %}
    </td>
    <td class="text-center">
      {% if caserow.0.phone_investigator == user.name %}<i style="color:green;" class="fa fa-check"></i>{% endif %}
    </td>
  </tr>
{% endif %}
{% endfor %}
</table>
<button type="submit" class="btn btn-success"><i class="fa fa-lock"></i> {{ lang.set_case_access_rights }}</button>
</form>
{% endif %}
</div>
{% if settings.show_log == "1" %}
<div role="tabpanel" class="tab-pane{% if returntab == "caselog" %} active{% endif %}" id="tab-caselog">
<h3 class="page-heading">{{ lang.case_log }}
  <span class="pull-right">
    <a href="timeline.php?case={{ caserow.0.id }}" class="btn btn-success" target="_blank"><i class="fa fa-calendar"></i></a>
  </span>
</h3>

{% if caselog %}
<table class="table table-condensed" style=";background-color:#FFF;">
  <thead>
    <th style="width:100px;white-space:nowrap;">{{ lang.timestamp }}</th>
    <th style="width:60px;white-space:nowrap;">{{ lang.user }}</th>
    <th>{{ lang.event_details }}</th>
  </thead>

{% set line_id = 0 %}
{% for line in caselog %}
{% set line_id = line_id + 1%}
  <tr>
    {% set line = line|split(';') %}
    <td style="width:100px;white-space:nowrap;">{{ line.0|date("Y-m-d H:i") }}</td>
    <td style="width:60px;white-space:nowrap;">{% if session.user.username == line.1 %}<b>{{ line.1 }}</b>{% else %}{{ line.1 }}{% endif %}</td>
    <td>{% if line.2 == "Add" %}<i class="fa fa-plus" style="color:green;"></i>{% elseif line.2 == "Access" %}<i class="fa fa-user" style="color:black;"></i>{% elseif line.2 == "Update" %}<i class="fa fa-refresh" style="color:blue;"></i>{% elseif line.2 == "Remove" %}<i class="fa fa-minus" style="color:red;"></i>{% elseif line.2 == "Error" %}<i class="fa fa-times" style="color:red;"></i>{% elseif line.2 == "Action" %}<i class="fa fa-arrow-right" style="color:blue;"></i>{% endif %} {{ line.2 }}: {{ line.3|replace({"\"": ""}) }}</td>
  </tr>
{% endfor %}
</table>
{% else %}
<div class="alert alert-danger" role="alert">{{ lang.no_events }}</div>
{% endif %}

</div>
{% endif %}
</div>
</div>
<!-- tabit loppuu -->
</div>
</div>
</div>
{% endblock %}
